asyncapi: '2.0.0'
id: 'urn:com.asyncapi.scp.lifecycle'
info:
  title: scp-events
  version: '0.1.0'
  description: |
    Partner and first User ingestion lifecycle events.
servers:
  sit:
    url: TBD
    protocol: kafka
    description: non-prod env
    security:
      - cert: []
    variables:
      port:
        description: Secure connection (TLS) is available through port 9094.
        default: '9094'
        enum:
          - '9094'
components:
  securitySchemes:
    cert:
      type: X509
      description: Public Key Certificate
  schemas:
    userItem:
      type: object
      description: Service Provider used by a partner
      properties:
        entityType:
          type: string
          description: The type of Entity
          enum: [USER]
        ingested:
          type: boolean
          description: Flag to indicate if the entity was ingested in SCP
        environment:
          type: string
          description: SCP environment this message was ingested. e.g. CS, stage, prod
        guid:
          type: string
          description: Unique GUID of the Partner this User belongs to
        oktaId:
          type: string
          description: User's unique ID
        email:
          type: string
          description: User Entity's email address
        roles:
          type: array
          items:
            type: string
            description: Roles given to this user in SCP after ingestion
        message:
          type: string
          description: Error message if the ingestion failed in SCP

  messages:
    partnerIngested:
      summary: Partner Ingestion event in SCP
      description: |
        Whether or not Partner ingestion was successful or not
      tags:
        - name: partner
      payload:
        type: object
        properties:
          entityType:
            type: string
            description: The type of Entity
            enum: [PARTNER]
          ingested:
            type: boolean
            description: Flag to indicate if the entity was ingested in SCP
          environment:
            type: string
            description: SCP environment this message was ingested. e.g. CS, stage, prod
          guid:
            type: string
            description: Unique UUID
          message:
            type: string
            description: Error message if the ingestion for the Partner or SPIDs failed in SCP
    usersIngested:
      summary: Partner Users Ingestion event in SCP
      description: |
        Whether or not Users ingestion was successful or not
      tags:
        - name: User
      payload:
        type: array
        items:
          type: object
          $ref: '#/components/schemas/userItem'


channels:
  # Partner Events
  scp/partner/ingested/e1-np/1.0:
    publish:
      operationId: ingestPartner
      summary: Partner was ingested in SCP
      message:
        "$ref": "#/components/messages/partnerIngested"
  scp/user/ingested/e1-np/1.0:
    publish:
      operationId: ingestUsers
      summary: Users were ingested in SCP
      message:
        "$ref": "#/components/messages/usersIngested"

